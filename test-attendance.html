<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Attendance API Test</title>
  </head>
  <body>
    <h1>Attendance API Test</h1>
    <div id="results"></div>

    <script>
      const testAttendanceAPI = async () => {
        const resultsDiv = document.getElementById("results");

        try {
          // Step 1: Login
          resultsDiv.innerHTML += "<p>üîÑ Step 1: Testing login...</p>";

          const loginResponse = await fetch(
            "http://localhost:5001/api/auth/login",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              credentials: "include",
              body: JSON.stringify({
                email: "employee.dev@gmail.com",
                password: "employee123",
              }),
            }
          );

          const loginData = await loginResponse.json();

          if (loginData.success) {
            resultsDiv.innerHTML += "<p>‚úÖ Login successful!</p>";
            const token = loginData.data.token;

            // Step 2: Test attendance API
            resultsDiv.innerHTML +=
              "<p>üîÑ Step 2: Testing attendance API...</p>";

            const attendanceResponse = await fetch(
              "http://localhost:5001/api/attendance/today",
              {
                method: "GET",
                headers: {
                  Authorization: `Bearer ${token}`,
                  "Content-Type": "application/json",
                },
                credentials: "include",
              }
            );

            const attendanceData = await attendanceResponse.json();

            if (attendanceData.success) {
              resultsDiv.innerHTML += "<p>‚úÖ Attendance API working!</p>";
              resultsDiv.innerHTML += `<pre>${JSON.stringify(
                attendanceData,
                null,
                2
              )}</pre>`;
            } else {
              resultsDiv.innerHTML += `<p>‚ùå Attendance API failed: ${attendanceData.message}</p>`;
            }
          } else {
            resultsDiv.innerHTML += `<p>‚ùå Login failed: ${loginData.message}</p>`;
          }
        } catch (error) {
          resultsDiv.innerHTML += `<p>‚ùå Error: ${error.message}</p>`;
          console.error("Test error:", error);
        }
      };

      // Run test when page loads
      testAttendanceAPI();
    </script>
  </body>
</html>
